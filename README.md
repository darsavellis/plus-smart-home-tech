# Plus Smart Home Tech

## Обзор

Проект Plus Smart Home Tech представляет собой систему для работы с устройствами умного дома. Сервис собирает и
обрабатывает телеметрические данные от различных датчиков и хабов, предоставляя возможность управления умным домом.

## Структура проекта

Проект разделен на три основных модуля:

- **telemetry** - модуль для обработки телеметрических данных от устройств
    - **collector** - сервис для сбора данных от хабов и отправки в Kafka
    - **serialization** - модуль со схемами данных
        - **avro-schemas** - схемы Avro и сгенерированные классы
        - **proto-schemas** - схемы Protobuf и сгенерированные классы
- **infra** - инфраструктурные компоненты
- **commerce** - модуль для поддержки продаж устройств умного дома

## Сервис Collector

Сервис принимает данные от хабов пользователей в формате JSON через HTTP-протокол, кодирует их в формат Avro и сохраняет
в топики Kafka.

### Типы данных:

1. **События от датчиков:**
    - датчики освещённости
    - датчики температуры
    - умные переключатели
    - климатические датчики
    - датчики движения

2. **События, связанные с хабом и сценариями:**
    - регистрация/дерегистрация датчиков
    - добавление/удаление сценариев

### Топики Kafka:

- **telemetry.sensors.v1** - данные, связанные с показаниями датчиков
- **telemetry.hubs.v1** - события от хабов (регистрация устройств, сценарии)
- **telemetry.snapshots.v1** - агрегированные данные за определённый период

## Сервис Aggregator

Сервис обрабатывает потоки данных из Kafka, агрегирует показания датчиков и создает снимки состояния умного дома. 
Агрегированные данные сохраняются в топик `telemetry.snapshots.v1`.

### Функциональность:
- Агрегация показаний датчиков по временным окнам
- Создание периодических снимков состояния устройств
- Обработка событий от хабов для актуализации состояния системы

## Сервис Analyzer

Анализирует агрегированные данные и события от хабов для:
- Выявления аномалий в показаниях датчиков
- Оптимизации сценариев работы устройств
- Генерации рекомендаций по настройке умного дома

## Требования к системе

- Java 21
- Docker и Docker Compose
- Apache Kafka
- PostgreSQL

## Запуск проекта

1. Сборка проекта:
```bash
mvn clean package
```

2. Запуск инфраструктуры:
```bash
docker compose up -d
```

## Разработка

### Работа со схемами данных

1. Схемы Avro находятся в `telemetry/serialization/avro-schemas/src/main/avro`
2. Схемы Protobuf находятся в `telemetry/serialization/proto-schemas/src/main/protobuf`

При изменении схем необходимо пересобрать проект для генерации новых классов.
